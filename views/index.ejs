<html lang="en">

<head>
    <title>Matterport Test</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0, shrink-to-fit=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <script src="/app-bundle.js" defer></script>
    <link rel="stylesheet" href="/styles.css">
    <link rel="icon" type="image/x-icon" href="/UPHEAVAL.png">

    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/templatemo.css">
    <link rel="stylesheet" href="assets/css/custom.css">
    <link rel="stylesheet" href="/src/css/style.css">

    <!-- Load fonts style after rendering the layout styles -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;700;900&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
    <link rel="stylesheet" href="assets/css/fontawesome.min.css">
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>

    <!-- Bootstrap Drawer -->
    <link rel="stylesheet" href="/dist/css/bootstrap-drawer.min.css">
    <link rel="stylesheet" href="/dist/css/bootstrap-drawer.css">
    <script src="/dist/js/bootstrap-drawer.js"></script>
    <script src="/dist/js/bootstrap-drawer.min.js"></script>
    <!-- Bootstrap -->
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script> -->
    <link rel="stylesheet" href="/src/css/login.css">
</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-light shadow">
        <div class="container d-flex justify-content-between align-items-center">

            <a href="/"><img class="brand-img-hover" src="/UPHEAVAL.png" height="50px" width="50px"></a>

            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#templatemo_main_nav" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="align-self-center collapse navbar-collapse flex-fill  d-lg-flex justify-content-lg-between" id="templatemo_main_nav">
                <div class="flex-fill">
                    <ul class="nav navbar-nav d-flex justify-content-between mx-lg-auto">

                    </ul>
                </div>
                <div class="navbar align-self-center d-flex">
                    <div class="d-lg-none flex-sm-fill mt-3 mb-4 col-7 col-sm-auto pr-3">
                        <div class="input-group">
                            <input type="text" class="form-control" id="inputMobileSearch" placeholder="Search ...">
                            <div class="input-group-text">
                                <i class="fa fa-fw fa-search"></i>
                            </div>
                        </div>
                    </div>

                    <!-- <button type="button" class="btn btn-primary" data-toggle="drawer" data-target="#my-drawer"> -->
                    <a id="open_cart" data-toggle="drawer" data-target="#my-drawer" class="nav-icon position-relative text-decoration-none" href="">
                        <i class="fa fa-fw fa-cart-arrow-down text-dark mr-1"></i>
                        <span id="cart" class="position-absolute top-0 left-100 translate-middle badge rounded-pill bg-light text-dark">
                            <% if (typeof cart == 'undefined') {%>
                                0
                                <%} else {%> 
                                    <%=cart.length%>
                                    <%} %>
                        </span>
                    </a>
                    <!-- </button> -->

                    <%if (loggedIn) {%>
                        <a class="nav-icon position-relative text-decoration-none" href="/users/logout">
                            <i class="fa fa-fw fa-user text-dark mr-3"></i>
                            <!-- <p>Login</p> -->
                            <span style="margin-left: 20px;" class="position-absolute top-50 left-100 translate-middle badge text-dark">Logout</span>
                        </a>
                        <%} else {%>
                            <a class="nav-icon position-relative text-decoration-none" href="/users/login">
                                <i class="fa fa-fw fa-user text-dark mr-3"></i>
                                <!-- <p>Login</p> -->
                                <span style="margin-left: 20px;" class="position-absolute top-50 left-100 translate-middle badge text-dark">Login</span>
                            </a>
                            <%} %>
                </div>
            </div>

        </div>
    </nav>
    <div id="box">
        <center>
            <%- messages('messages', locals) %>
                <% if(errors) {%>
                    <% errors.forEach(function(error){%>
                        <div class="alert alert-danger">
                            <%= error.msg %>
                        </div>
                        <% }); %>
                            <% }%>
        </center>
    </div>
    <iframe id="showcase" width="100%" height="100%" title="test" frameBorder="0" allowFullScreen allow=""></iframe>

    <!-- cart drawer Start -->
    <div id="my-drawer" style="width: 40%;" class="drawer drawer-right slide" tabindex="-1" role="dialog" aria-labelledby="drawer-1-title" aria-hidden="true" id="drawer-1">
        <div id="drawr" class="drawer-content drawer-content-scrollable" role="document">
            <div class="drawer-header d-flex align-items-center" style="padding-top: 50px;">
                <!-- <h4 class="drawer-title" id="drawer-1-title">Drawer Title</h4> -->
                <div class="d-flex">
                    <i class="fa fa-fw fa-cart-arrow-down text-dark mr-1" style="font-size: 30px;"></i>&nbsp;&nbsp;&nbsp;
                    <span id="cart-header" style="margin-left: 30px;" class="position-absolute left-100 translate-middle badge rounded-pill bg-light text-dark">
                        <% if (typeof cart == 'undefined') {%>
                            0
                            <%} else {%> 
                                <%=cart.length%>
                                <%} %>
                    </span>
                    <span>Your Cart</span>
                </div>
                <span class="position-absolute" style="left: 15px; top: 15px;"><i style="font-size: 24px;" data-dismiss="drawer" class="fa-solid fa-xmark"></i></span>

                <% if (typeof cart != 'undefined') {%>
                    <span id="cart-header" style="right: 20px;" class="position-absolute text-dark"><%= parseFloat(cart[0].total).toFixed(2)%> $</span>
                    <%} %>
            </div>

            <div class="drawer-body">
                <div class="items-list">
                    <% if (typeof cart !== "undefined") {%>
                        <% cart.forEach(function(product, index) { %>
                            <div class="row align-items-start">
                                <div class="col-auto">
                                    <img style="height: 80px; width: 80px;" class="avatar" src="/images/<%=product.slug%>.png">
                                </div>
                                <div class="col align-bottom">
                                    <div style="padding-top: 20px; padding-left: 20px;">
                                        <%=product.name%>
                                    </div>
                                    <div class="d-flex align-items-center" style="padding-left: 20px; display: inline-block;">
                                        <% if(product.qty==1) {%>
                                            <i onclick="updateCart('clear','<%=index%>')" id="decrease" style="font-size: 14px;" class="fa-solid fa-trash"></i> &nbsp;
                                            <%} else {%>
                                                <i onclick="updateCart('minus','<%=index%>')" id="decrease" style="font-size: 14px;" class="fa-solid fa-minus"></i> &nbsp;
                                                <%}%>
                                                    <p id="qty<%=index%>" style="font-size: 16px !important; text-align: center; margin: 0px !important;">
                                                        <%=product.qty%>
                                                    </p>&nbsp;
                                                    <i onclick="updateCart('add','<%=index%>')" id="increase" style="font-size: 14px;" class="fa-solid fa-plus"></i>
                                    </div>
                                    <!-- <span class="label">List item</span>
                                    <span class="second-label">second label</span>
                                    <span class="second-action mif-alarm fg-red">Alarm</span> -->
                                </div>
                                <div class="col-auto align-right" style="padding-left: 5px; padding-right: 14px;">
                                    <p style="height: 80px; width: 80px; font-size: 16px; text-align: right; padding-top: 20px; padding-left: 5px;">
                                        <%= parseFloat(product.price * product.qty).toFixed(2)%> $</p>
                                </div>
                            </div>
                            <br>
                            <%}) %>
                                <%} else {%>
                                    <p style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);"> Add products in cart</p>
                                    <%} %>
                </div>

            </div>
            <% if (typeof cart !== "undefined"){%>
                <div class="drawer-footer">
                    <button onclick="checkout()" style="width: 100%; height:100%;" type="button" class="btn btn-primary">
                                    Checkout
                                </button>
                </div>
                <%}%>
        </div>
    </div>
    <!-- cart drawer End -->
    <div id="snackbar">Added to cart</div>


    <script src="assets/js/jquery-1.11.0.min.js"></script>
    <script src="assets/js/jquery-migrate-1.2.1.min.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/templatemo.js"></script>
    <script src="assets/js/custom.js"></script>
</body>

<script>
    function updateCart(action, index) {
        console.log(action, index)
        $.ajax({ // asking for values
            method: 'POST',
            url: '/cart/update',
            dataType: 'json',
            data: {
                index: index,
                action: action
            }
        }).then((result) => {
            console.log("back");
            console.log(result);
            $('#cart').text(result.cartLength.toString())
            $("#drawr").load(window.location.href + " #drawr");
        });
    }

    function checkout() {
        console.log("Checkout")
        $.ajax({ // asking for values
            method: 'POST',
            url: '/cart/checkout',
            dataType: 'json',
            data: {
                msg: "checkout"
            }
        }).then((result) => {
            console.log("back");
            // location.reload();
            let path = window.location.href;
            path = path + 'cart/checkout'
            console.log(path)
            window.location.replace(path);
        });
    }
    $(document).ready(() => {
        $('#my-drawer').on('show.bs.drawer', function() {
            console.log("hurraaahhh");
            $('#my-drawer').trigger('focus');
        })
        $("#load").click(() => {
            console.log("Hello world");
            // $('#my-drawer').drawer('toggle');
            $("#drawr").load(window.location.href + " #drawr");
        });
    });
</script>

</html>